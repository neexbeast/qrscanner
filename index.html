<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>PWA</title>
    <link rel="stylesheet" href="src/master.css">
    <link rel="mainfest" href="/manifest.json">
    <link rel="stylesheet" href="css/bootstrap.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.5.1/jquery.min.js"></script>
</head>

<body class="d-flex align-items-center">
    <button onclick="playVideo()" id="playVideo">Open scanner</button>
    <div class="container">

        <video id="video" width="100%" height="100%"></video>

    </div>
    <script>
        // $(document).ready(function () {
        //     $('#playVideo').click(function {

        //     })
        // });
        var myVideo = document.getElementById("video");
        function playVideo() {
            if (myVideo.paused) {
                $("#video").show();
                myVideo.play();
            } else {
                myVideo.pause();
                $("#video").hide();
            }
        }
        // Get the video element
        const video = document.querySelector('#video')
        // Check if device has camera
        if (navigator.mediaDevices && navigator.mediaDevices.getUserMedia) {
            console.log(navigator.mediaDevices.getUserMedia)
            // Use video without audio
            const constraints = {
                video: { facingMode: { exact: "environment" } },
                audio: false
            }

            // Start video stream
            navigator.mediaDevices.getUserMedia(constraints).then(stream => video.srcObject = stream);
        }

        const barcodeDetector = new BarcodeDetector({ formats: ['qr_code'] });
        const detectCode = () => {
            // Start detecting codes on to the video element
            barcodeDetector.detect(video).then(codes => {
                // If no codes exit function
                if (codes.length === 0) return;

                for (const barcode of codes) {
                    // Log the barcode to the console
                    console.log(barcode)
                }
            }).catch(err => {
                // Log an error if one happens
                console.error(err);
            })
        }
        setInterval(detectCode, 1000);

    </script>
    <script src="js/bootstrap.js"></script>
    <script src="src/index.js"></script>
</body>

</html>